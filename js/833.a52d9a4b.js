"use strict";(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[833],{8833:(e,t,r)=>{r.r(t),r.d(t,{default:()=>I});var s=r(3673),a=r(2323);const o=(0,s.HX)("data-v-6fe86f27");(0,s.dD)("data-v-6fe86f27");const i=(0,s.Wm)("div",{class:"text-h4"},"Scanner",-1),n=(0,s.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"QR code scanner for checking drivers in and out.",-1),l={key:0,class:"row justify-center items-center"},u=(0,s.Wm)("div",{class:"text-h6"},"Alert",-1),d=(0,s.Wm)("span",{class:"q-mb-md"},"You do not have any warehouses set up. To check drivers in, you need to create at least one warehouse first.",-1),c=(0,s.Wm)("div",{class:"text-h6"},"Scanner not available",-1),h={class:"q-mb-md"};(0,s.Cn)();const m=o(((e,t,r,m,p,w)=>{const f=(0,s.up)("q-icon"),g=(0,s.up)("q-item-section"),b=(0,s.up)("q-item-label"),R=(0,s.up)("q-item"),W=(0,s.up)("q-select"),v=(0,s.up)("qrcode-stream"),q=(0,s.up)("q-card-section"),_=(0,s.up)("q-btn"),y=(0,s.up)("q-card-actions"),E=(0,s.up)("q-card"),k=(0,s.up)("q-dialog"),D=(0,s.up)("q-page"),Q=(0,s.Q2)("close-popup");return w.hasPermission&&p.isLoaded?((0,s.wg)(),(0,s.j4)(D,{key:0,padding:""},{default:o((()=>[i,n,(0,s.Wm)(W,{class:"q-mb-md",filled:"",modelValue:p.warehouse,"onUpdate:modelValue":t[1]||(t[1]=e=>p.warehouse=e),hint:"Drivers you check in will be available at the selected warehouse.",options:p.warehouseList,label:"Warehouse","stack-label":""},{option:o((e=>[(0,s.Wm)(R,e.itemProps,{default:o((()=>[(0,s.Wm)(g,{avatar:""},{default:o((()=>[(0,s.Wm)(f,{name:"mdi-warehouse"})])),_:1}),(0,s.Wm)(g,null,{default:o((()=>[(0,s.Wm)(b,{innerHTML:e.opt.name},null,8,["innerHTML"]),(0,s.Wm)(b,{caption:""},{default:o((()=>[(0,s.Uk)("ID: "+(0,a.zw)(e.opt.id),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options"]),p.error?((0,s.wg)(),(0,s.j4)("div",l,[(0,s.Wm)(f,{name:"error",class:"text-h1 red-5"})])):(0,s.kq)("",!0),(0,s.Wm)(v,{onDecode:w.onDecode,onInit:w.onInit},null,8,["onDecode","onInit"]),(0,s.Wm)(k,{modelValue:p.showDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>p.showDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:o((()=>[(0,s.Wm)(E,{style:{width:"350px"}},{default:o((()=>[(0,s.Wm)(q,null,{default:o((()=>[u])),_:1}),(0,s.Wm)(q,{class:"row items-center"},{default:o((()=>[d])),_:1}),(0,s.Wm)(y,{align:"right",class:"bg-white"},{default:o((()=>[(0,s.wy)((0,s.Wm)(_,{flat:"",label:"Go to warehouses page",class:"text-blue-9",onClick:t[2]||(t[2]=t=>e.$router.push("/warehouses"))},null,512),[[Q]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),!p.showDialog&&p.error?((0,s.wg)(),(0,s.j4)(k,{key:1,modelValue:p.showErrorDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>p.showErrorDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:o((()=>[(0,s.Wm)(E,{style:{width:"350px"}},{default:o((()=>[(0,s.Wm)(q,null,{default:o((()=>[c])),_:1}),(0,s.Wm)(q,{class:"row items-center"},{default:o((()=>[(0,s.Wm)("span",h,(0,a.zw)(p.error),1)])),_:1}),(0,s.Wm)(y,{align:"right",class:"bg-white"},{default:o((()=>[(0,s.wy)((0,s.Wm)(_,{flat:"",label:"OK",class:"text-blue-9"},null,512),[[Q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,s.kq)("",!0)])),_:1})):(0,s.kq)("",!0)}));var p=r(362),w=r(1959);const f={name:"Scan",components:{QrcodeStream:p.QrcodeStream},data(){return{isLoaded:!1,warehouseList:[],warehouse:(0,w.iH)(null),result:"",error:"",driver:null,showDialog:!1,showErrorDialog:!0}},mounted(){this.$api.get("/warehouse/index").then((e=>{this.warehouseList=e.data,this.warehouseList.forEach((e=>e.label=e.name)),this.warehouse=this.warehouseList[0],this.isLoaded=!0,this.warehouseList.length||(this.showDialog=!0)}))},computed:{hasPermission(){return!!this.$store.getters["auth/isSuperUser"]||this.$store.state.auth.user.level>=3}},methods:{onDecode(e){this.result=e},async onInit(e){try{await e}catch(t){"NotAllowedError"===t.name?this.error="ERROR: you need to grant camera access permission":"NotFoundError"===t.name?this.error="ERROR: no camera on this device":"NotSupportedError"===t.name?this.error="ERROR: secure context required. use HTTPS for your site.":"NotReadableError"===t.name?this.error="ERROR: is the camera already in use?":"OverconstrainedError"===t.name?this.error="ERROR: installed cameras are not suitable":"StreamApiNotSupportedError"===t.name?this.error="ERROR: Stream API is not supported in this browser":"InsecureContextError"===t.name?this.error="ERROR: Camera access is only permitted in secure context. Use HTTPS for your site.":this.error=`ERROR: Camera error (${t.name})`}}},watch:{hasPermission(e){e||this.unauthorizedRedirect()},error(e){e&&this.$q.notify({message:e,color:"red-9"})},result(e){e&&this.$api.post("/driver/"+e+"/check",{warehouse:this.warehouse.id}).then((t=>{this.result="",this.$router.push("/scan/result/"+e)}))}}};var g=r(4379),b=r(3314),R=r(3414),W=r(2035),v=r(4554),q=r(2350),_=r(6778),y=r(151),E=r(5589),k=r(9367),D=r(2165),Q=r(677),S=r(7518),x=r.n(S);f.render=m,f.__scopeId="data-v-6fe86f27";const I=f;x()(f,"components",{QPage:g.Z,QSelect:b.Z,QItem:R.Z,QItemSection:W.Z,QIcon:v.Z,QItemLabel:q.Z,QDialog:_.Z,QCard:y.Z,QCardSection:E.Z,QCardActions:k.Z,QBtn:D.Z}),x()(f,"directives",{ClosePopup:Q.Z})}}]);
"use strict";(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[598],{1598:(e,s,a)=>{a.r(s),a.d(s,{default:()=>E});var t=a(3673),i=a(2323);const l=(0,t.HX)("data-v-1123441e");(0,t.dD)("data-v-1123441e");const o=(0,t.Wm)("div",{class:"text-h4"},"Gatepass (Routes)",-1),d=(0,t.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"All (reviewed) gatepasses issued to vehicles.",-1),r=(0,t.Wm)("div",{class:"col-auto text-grey-5 text-h5"}," No requests for now. ",-1),n={class:"text-h6"},h={class:"q-mb-md text-body2 text-grey-6"},u=(0,t.Wm)("div",{class:"text-h6"},"Are you sure?",-1),p={class:"q-mb-md"},c=(0,t.Wm)("br",null,null,-1),m=(0,t.Wm)("br",null,null,-1),g=(0,t.Uk)("Note that the driver's status will be reset to available at the previous warehouse."),w={class:"col-auto"};(0,t.Cn)();const v=l(((e,s,a,v,f,b)=>{const W=(0,t.up)("q-btn"),G=(0,t.up)("q-table"),_=(0,t.up)("q-card-section"),k=(0,t.up)("q-icon"),q=(0,t.up)("q-item-section"),y=(0,t.up)("q-item-label"),D=(0,t.up)("q-item"),x=(0,t.up)("q-select"),C=(0,t.up)("q-card-actions"),$=(0,t.up)("q-card"),I=(0,t.up)("q-dialog"),L=(0,t.up)("q-page-sticky"),Z=(0,t.up)("q-page"),Q=(0,t.up)("q-spinner"),z=(0,t.Q2)("close-popup");return b.hasPermission&&f.isLoaded?((0,t.wg)(),(0,t.j4)(Z,{key:0,padding:""},{default:l((()=>[o,d,(0,t.Wm)(G,{grid:"",rows:f.rows,columns:[{name:"id",label:"Gatepass ID",field:"id"},{name:"vehicle",label:"Vehicle",field:"vehicle"},{name:"driver",label:"Driver",field:"driver"},{name:"starting",label:"Starting Warehouse",field:"starting"},{name:"warehouse",label:"Destined Warehouse",field:"warehouse"},{name:"updated_at",label:"Issued At",field:"updated_at"}],"row-key":"id","hide-header":"",pagination:{rowsPerPage:10},selection:"single"},{"no-data":l((()=>[r])),"body-selection":l((s=>[e.$store.getters["auth/isSuperUser"]||e.$store.state.auth.user.level>=3?((0,t.wg)(),(0,t.j4)(t.HY,{key:0},[(0,t.Wm)(W,{class:"full-width q-mb-sm",color:"blue-9",label:"Edit",icon:"edit",onClick:e=>{f.editing=s.row,f.showEditDialog=!0}},null,8,["onClick"]),(0,t.Wm)(W,{class:"full-width",color:"red-7",label:"Destroy",icon:"delete",onClick:e=>{f.deleting=s.row,f.showDeleteDialog=!0}},null,8,["onClick"])],64)):(0,t.kq)("",!0)])),_:1},8,["rows"]),f.isWarehouseListLoaded?((0,t.wg)(),(0,t.j4)(I,{key:0,modelValue:f.showEditDialog,"onUpdate:modelValue":s[3]||(s[3]=e=>f.showEditDialog=e),persistent:""},{default:l((()=>[(0,t.Wm)($,{style:{"min-width":"350px","max-width":"450px"}},{default:l((()=>[(0,t.Wm)(_,null,{default:l((()=>[(0,t.Wm)("div",n,"Edit Gatepass ID: "+(0,i.zw)(f.editing.id),1)])),_:1}),(0,t.Wm)(_,{class:"q-pt-none q-gutter-y-sm"},{default:l((()=>[(0,t.Wm)("div",h," This gatepass belongs to vehicle "+(0,i.zw)(f.editingGatepass.vehicle.name)+" (ID: "+(0,i.zw)(f.editingGatepass.vehicle.id)+"), dispatching from warehouse "+(0,i.zw)(f.editingGatepass.starting_warehouse.name)+" (ID: "+(0,i.zw)(f.editingGatepass.starting_warehouse.id)+") ",1),(0,t.Wm)(x,{class:"q-mb-md",filled:"",modelValue:f.editingGatepass.warehouse,"onUpdate:modelValue":s[1]||(s[1]=e=>f.editingGatepass.warehouse=e),hint:"The warehouse the vehicle is dispatched to.",options:f.warehouses,label:"Destined Warehouse","stack-label":""},{option:l((e=>[(0,t.Wm)(D,e.itemProps,{default:l((()=>[(0,t.Wm)(q,{avatar:""},{default:l((()=>[(0,t.Wm)(k,{name:"mdi-warehouse"})])),_:1}),(0,t.Wm)(q,null,{default:l((()=>[(0,t.Wm)(y,{innerHTML:e.opt.name},null,8,["innerHTML"]),(0,t.Wm)(y,{caption:""},{default:l((()=>[(0,t.Uk)("ID: "+(0,i.zw)(e.opt.id),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options"]),(0,t.Wm)(x,{class:"q-mb-md",filled:"",modelValue:f.editingGatepass.driver,"onUpdate:modelValue":s[2]||(s[2]=e=>f.editingGatepass.driver=e),hint:"Choose the vehicle you are dispatching. Please be aware that these are all the drivers from the starting warehouse, including those who are checked out.",options:f.editingGatepass.starting_warehouse.drivers,label:"Driver","stack-label":""},{option:l((e=>[(0,t.Wm)(D,e.itemProps,{default:l((()=>[(0,t.Wm)(q,{avatar:""},{default:l((()=>[(0,t.Wm)(k,{name:"airline_seat_recline_normalk"})])),_:1}),(0,t.Wm)(q,null,{default:l((()=>[(0,t.Wm)(y,{innerHTML:e.opt.name},null,8,["innerHTML"]),(0,t.Wm)(y,{caption:""},{default:l((()=>[(0,t.Uk)("ID: "+(0,i.zw)(e.opt.id),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:1}),(0,t.Wm)(C,{align:"right",class:"text-primary"},{default:l((()=>[(0,t.wy)((0,t.Wm)(W,{flat:"",label:"Cancel"},null,512),[[z]]),(0,t.wy)((0,t.Wm)(W,{flat:"",label:"Submit",onClick:b.updateGatepass},null,8,["onClick"]),[[z]])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,t.kq)("",!0),f.deletingGatepass?((0,t.wg)(),(0,t.j4)(I,{key:1,modelValue:f.showDeleteDialog,"onUpdate:modelValue":s[4]||(s[4]=e=>f.showDeleteDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:l((()=>[(0,t.Wm)($,{style:{width:"350px"}},{default:l((()=>[(0,t.Wm)(_,null,{default:l((()=>[u])),_:1}),(0,t.Wm)(_,{class:"row items-center"},{default:l((()=>[(0,t.Wm)("span",p,[(0,t.Uk)("You are destroying gatepass (ID: "+(0,i.zw)(f.deleting.id)+") for vehicle "+(0,i.zw)(f.deletingGatepass.vehicle.name)+"(ID: "+(0,i.zw)(f.deletingGatepass.vehicle.id)+")",1),c,m,g])])),_:1}),(0,t.Wm)(C,{align:"right",class:"bg-white"},{default:l((()=>[(0,t.wy)((0,t.Wm)(W,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[z]]),(0,t.wy)((0,t.Wm)(W,{label:"Confirm",class:"text-white",color:"red-7",onClick:b.deleteGatepass},null,8,["onClick"]),[[z]])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,t.kq)("",!0),e.$store.getters["auth/isSuperUser"]||e.$store.state.auth.user.level>=2?((0,t.wg)(),(0,t.j4)(L,{key:2,position:"bottom-right",offset:[50,50]},{default:l((()=>[(0,t.Wm)(W,{fab:"",icon:"south",color:"blue-9",onClick:s[5]||(s[5]=s=>e.$router.push("/dispatch"))})])),_:1})):(0,t.kq)("",!0)])),_:1})):((0,t.wg)(),(0,t.j4)(Z,{key:1,class:"flex flex-center"},{default:l((()=>[(0,t.Wm)("div",w,[(0,t.Wm)(Q,{color:"blue-9",size:"50px"})])])),_:1}))}));a(7280),a(5363);const f={name:"Gatepasses",data(){return{isLoaded:!1,gatepasses:[],rows:[],warehouses:[],showDeleteDialog:!1,deleting:null,deletingGatepass:null,showEditDialog:!1,editing:null,editingGatepass:null,isWarehouseListLoaded:!1}},methods:{unauthorizedRedirect(){this.$router.push("/"),this.$q.notify({message:"You are not authorized to use this page.",color:"red-7"})},loadGatepasses(){this.$api.get("/gatepass/reviewed/index").then((e=>{this.gatepasses=e.data,this.rows=[],this.gatepasses.forEach((e=>{this.rows.push({id:e.id,vehicle:e.vehicle.name+" (ID: "+e.vehicle.id+")",driver:e.driver.name+" (ID: "+e.driver.id+")",starting:e.starting_warehouse.name+" (ID: "+e.starting_warehouse.id+")",warehouse:e.warehouse.name+" (ID: "+e.warehouse.id+")",updated_at:e.updated_at.replace(".000000Z","").replace("T"," ")})})),this.isLoaded=!0})).catch((e=>{var s;this.$q.notify({message:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))},updateGatepass(){this.$api.post("/gatepass/"+this.editingGatepass.id+"/update",{warehouse:this.editingGatepass.warehouse.id,driver:this.editingGatepass.driver.id}).then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadGatepasses()})).catch((e=>{var s;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))},deleteGatepass(){this.$api.post("/gatepass/"+this.deletingGatepass.id+"/destroy").then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadGatepasses()})).catch((e=>{var s;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))}},computed:{hasPermission(){return!!this.$store.getters["auth/isSuperUser"]||this.$store.state.auth.user.level>=2}},watch:{hasPermission(e){e||this.unauthorizedRedirect()},editing(e){e&&(this.editingGatepass=null,this.gatepasses.forEach((s=>{e.id===s.id&&(this.editingGatepass=s)})),this.editingGatepass&&(this.editingGatepass.warehouse.label=this.editingGatepass.warehouse.name,this.editingGatepass.driver.label=this.editingGatepass.driver.name,this.isWarehouseListLoaded=!1,this.$api.get("/warehouse/index").then((e=>{this.warehouses=e.data,this.warehouses.forEach(((e,s,a)=>{e.id===this.editingGatepass.starting_warehouse.id&&a.splice(s,1)})),this.warehouses.forEach(((e,s,a)=>{e.label=e.name})),this.editingGatepass.starting_warehouse.drivers.forEach((e=>{e.label=e.name})),this.isWarehouseListLoaded=!0})).catch((e=>{var s;this.$q.notify({message:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to fetch list of warehouses",color:"red-9"})}))))},deleting(e){e&&(this.deletingGatepass=null,this.gatepasses.forEach((s=>{e.id===s.id&&(this.deletingGatepass=s)})),this.deletingGatepass)}},mounted(){this.loadGatepasses()}};var b=a(4379),W=a(6429),G=a(2165),_=a(6778),k=a(151),q=a(5589),y=a(3314),D=a(3414),x=a(2035),C=a(4554),$=a(2350),I=a(9367),L=a(1007),Z=a(9754),Q=a(677),z=a(7518),V=a.n(z);f.render=v,f.__scopeId="data-v-1123441e";const E=f;V()(f,"components",{QPage:b.Z,QTable:W.Z,QBtn:G.Z,QDialog:_.Z,QCard:k.Z,QCardSection:q.Z,QSelect:y.Z,QItem:D.Z,QItemSection:x.Z,QIcon:C.Z,QItemLabel:$.Z,QCardActions:I.Z,QPageSticky:L.Z,QSpinner:Z.Z}),V()(f,"directives",{ClosePopup:Q.Z})}}]);
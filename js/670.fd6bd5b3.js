"use strict";(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[670],{2670:(e,s,a)=>{a.r(s),a.d(s,{default:()=>P});var t=a(3673),l=a(2323);const i=(0,t.HX)("data-v-71a005fa");(0,t.dD)("data-v-71a005fa");const o=(0,t.Wm)("div",{class:"text-h4"},"Requests",-1),r=(0,t.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"All requests to issue gatepasses(assign drivers).",-1),n=(0,t.Wm)("div",{class:"col-auto text-grey-5 text-h5"}," No requests for now. ",-1),d=(0,t.Wm)("div",{class:"text-h6"},"Are you sure?",-1),p={class:"q-mb-md"},h=(0,t.Wm)("br",null,null,-1),u=(0,t.Wm)("br",null,null,-1),c=(0,t.Uk)("Gatepass will be issued and the driver will be assigned to the vehicle."),g=(0,t.Wm)("br",null,null,-1),m=(0,t.Wm)("br",null,null,-1),v=(0,t.Uk)("However, if the driver have had become unavailable, you will not be able to approve this request."),w=(0,t.Wm)("div",{class:"text-h6"},"Are you sure?",-1),f={class:"q-mb-md"},b=(0,t.Wm)("br",null,null,-1),W=(0,t.Wm)("br",null,null,-1),q=(0,t.Uk)("Nothing other than this request record being deleted from the database will happen as dispatching only takes effect after being reviewed."),k={class:"col-auto"};(0,t.Cn)();const y=i(((e,s,a,y,D,G)=>{const _=(0,t.up)("q-btn"),x=(0,t.up)("q-table"),C=(0,t.up)("q-card-section"),$=(0,t.up)("q-card-actions"),z=(0,t.up)("q-card"),A=(0,t.up)("q-dialog"),I=(0,t.up)("q-page"),Z=(0,t.up)("q-spinner"),Q=(0,t.Q2)("close-popup");return G.hasPermission&&D.isLoaded?((0,t.wg)(),(0,t.j4)(I,{key:0,padding:""},{default:i((()=>[o,r,(0,t.Wm)(x,{grid:"",rows:D.rows,columns:[{name:"id",label:"Gatepass ID",field:"id"},{name:"vehicle",label:"Vehicle",field:"vehicle"},{name:"driver",label:"Driver",field:"driver"},{name:"starting",label:"Starting Warehouse",field:"starting"},{name:"warehouse",label:"Destined Warehouse",field:"warehouse"},{name:"created_at",label:"Request Sent At",field:"created_at"}],"row-key":"id","hide-header":"",pagination:{rowsPerPage:10},selection:"single"},{"no-data":i((()=>[n])),"body-selection":i((s=>[e.$store.getters["auth/isSuperUser"]||e.$store.state.auth.user.level>=3?((0,t.wg)(),(0,t.j4)(t.HY,{key:0},[(0,t.Wm)(_,{class:"full-width q-mb-sm",color:"green-7",label:"Approve",icon:"check_circle",onClick:e=>{D.approving=s.row,D.showApproveDialog=!0}},null,8,["onClick"]),(0,t.Wm)(_,{class:"full-width",color:"red-7",label:"Deny",icon:"do_not_disturb",onClick:e=>{D.deleting=s.row,D.showDeleteDialog=!0}},null,8,["onClick"])],64)):(0,t.kq)("",!0)])),_:1},8,["rows"]),D.approvingGatepass?((0,t.wg)(),(0,t.j4)(A,{key:0,modelValue:D.showApproveDialog,"onUpdate:modelValue":s[1]||(s[1]=e=>D.showApproveDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:i((()=>[(0,t.Wm)(z,{style:{width:"350px"}},{default:i((()=>[(0,t.Wm)(C,null,{default:i((()=>[d])),_:1}),(0,t.Wm)(C,{class:"row items-center"},{default:i((()=>[(0,t.Wm)("span",p,[(0,t.Uk)("You are approving dispatching(gatepass) request (ID: "+(0,l.zw)(D.approvingGatepass.id)+") for vehicle "+(0,l.zw)(D.approvingGatepass.vehicle.name)+"(ID: "+(0,l.zw)(D.approvingGatepass.vehicle.id)+")",1),h,u,c,g,m,v])])),_:1}),(0,t.Wm)($,{align:"right",class:"bg-white"},{default:i((()=>[(0,t.wy)((0,t.Wm)(_,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[Q]]),(0,t.wy)((0,t.Wm)(_,{label:"Confirm",class:"text-white",color:"green-7",onClick:G.approveGatepass},null,8,["onClick"]),[[Q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,t.kq)("",!0),D.deletingGatepass?((0,t.wg)(),(0,t.j4)(A,{key:1,modelValue:D.showDeleteDialog,"onUpdate:modelValue":s[2]||(s[2]=e=>D.showDeleteDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:i((()=>[(0,t.Wm)(z,{style:{width:"350px"}},{default:i((()=>[(0,t.Wm)(C,null,{default:i((()=>[w])),_:1}),(0,t.Wm)(C,{class:"row items-center"},{default:i((()=>[(0,t.Wm)("span",f,[(0,t.Uk)("You are denying dispatching(gatepass) request (ID: "+(0,l.zw)(D.deleting.id)+") for vehicle "+(0,l.zw)(D.deletingGatepass.vehicle.name)+"(ID: "+(0,l.zw)(D.deletingGatepass.vehicle.id)+")",1),b,W,q])])),_:1}),(0,t.Wm)($,{align:"right",class:"bg-white"},{default:i((()=>[(0,t.wy)((0,t.Wm)(_,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[Q]]),(0,t.wy)((0,t.Wm)(_,{label:"Confirm",class:"text-white",color:"red-7",onClick:G.deleteGatepass},null,8,["onClick"]),[[Q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,t.kq)("",!0)])),_:1})):((0,t.wg)(),(0,t.j4)(I,{key:1,class:"flex flex-center"},{default:i((()=>[(0,t.Wm)("div",k,[(0,t.Wm)(Z,{color:"blue-9",size:"50px"})])])),_:1}))}));a(7280),a(5363);const D={name:"Gatepasses",data(){return{isLoaded:!1,gatepasses:[],rows:[],warehouses:[],showDeleteDialog:!1,deleting:null,deletingGatepass:null,showApproveDialog:!1,approving:null,approvingGatepass:null}},methods:{unauthorizedRedirect(){this.$router.push("/"),this.$q.notify({message:"You are not authorized to use this page.",color:"red-7"})},loadGatepasses(){this.$api.get("/gatepass/request/index").then((e=>{this.gatepasses=e.data,this.rows=[],this.gatepasses.forEach((e=>{this.rows.push({id:e.id,vehicle:e.vehicle.name+" (ID: "+e.vehicle.id+")",driver:e.driver.name+" (ID: "+e.driver.id+")",starting:e.starting_warehouse.name+" (ID: "+e.starting_warehouse.id+")",warehouse:e.warehouse.name+" (ID: "+e.warehouse.id+")",created_at:e.created_at.replace(".000000Z","").replace("T"," ")})})),this.isLoaded=!0})).catch((e=>{var s;this.$q.notify({message:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))},deleteGatepass(){this.$api.post("/gatepass/"+this.deletingGatepass.id+"/deny").then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadGatepasses()})).catch((e=>{var s;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))},approveGatepass(){this.$api.post("/gatepass/"+this.approvingGatepass.id+"/approve").then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadGatepasses()})).catch((e=>{var s;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))}},computed:{hasPermission(){return!!this.$store.getters["auth/isSuperUser"]||this.$store.state.auth.user.level>=3}},watch:{hasPermission(e){e||this.unauthorizedRedirect()},deleting(e){e&&(this.deletingGatepass=null,this.gatepasses.forEach((s=>{e.id===s.id&&(this.deletingGatepass=s)})))},approving(e){e&&(this.approvingGatepass=null,this.gatepasses.forEach((s=>{e.id===s.id&&(this.approvingGatepass=s)})))}},mounted(){this.loadGatepasses()}};var G=a(4379),_=a(6429),x=a(2165),C=a(6778),$=a(151),z=a(5589),A=a(9367),I=a(9754),Z=a(677),Q=a(7518),U=a.n(Q);D.render=y,D.__scopeId="data-v-71a005fa";const P=D;U()(D,"components",{QPage:G.Z,QTable:_.Z,QBtn:x.Z,QDialog:C.Z,QCard:$.Z,QCardSection:z.Z,QCardActions:A.Z,QSpinner:I.Z}),U()(D,"directives",{ClosePopup:Z.Z})}}]);
"use strict";(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[363],{1363:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});a(7280);var s=a(3673),i=a(2323);const l=(0,s.HX)("data-v-d2389db2");(0,s.dD)("data-v-d2389db2");const o=(0,s.Wm)("div",{class:"text-h4"},"Drivers",-1),r=(0,s.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"All drivers registered in your company.",-1),d={class:"row q-gutter-y-sm"},n={class:"col-xs-12 col-sm-6"},u=(0,s.Wm)("div",{class:"q-pl-xs full-width text-grey-8"},"Profile: ",-1),h=(0,s.Wm)("div",{class:"q-pl-xs full-width text-grey-8"},"Commands: ",-1),c={class:"q-gutter-x-md q-gutter-y-sm"},m=(0,s.Wm)("div",{class:"q-pl-xs full-width text-grey-8 q-mt-sm"},"Photo: ",-1),p={key:1},g={class:"col-xs-12 col-sm-6"},v=(0,s.Wm)("div",{class:"q-pl-xs full-width text-grey-8"},"QR Code for checking in and out: ",-1),f=(0,s.Wm)("div",{class:"q-pl-xs full-width text-grey-6"},"You can print this out and use it for checking in and out this driver with the dashboard built-in QR scanner, so that the system knows if the driver is available.",-1),w={key:1,class:"col-auto"},y=(0,s.Wm)("div",{class:"text-h6"},"Are you sure?",-1),D={class:"q-mb-md"},b=(0,s.Wm)("div",{class:"text-h6"},"Edit Driver",-1),W=(0,s.Wm)("div",{class:"text-h6"},"Create New Driver",-1),q={class:"col-auto"};(0,s.Cn)();const k=l(((e,t,a,k,x,_)=>{const C=(0,s.up)("q-icon"),$=(0,s.up)("q-input"),V=(0,s.up)("q-chip"),Q=(0,s.up)("q-btn"),L=(0,s.up)("vue-qrcode"),U=(0,s.up)("q-card-section"),Z=(0,s.up)("q-card"),j=(0,s.up)("q-expansion-item"),S=(0,s.up)("q-list"),E=(0,s.up)("q-uploader"),I=(0,s.up)("q-card-actions"),P=(0,s.up)("q-dialog"),A=(0,s.up)("q-page-sticky"),N=(0,s.up)("q-page"),z=(0,s.up)("q-spinner"),F=(0,s.Q2)("close-popup");return x.isLoaded?((0,s.wg)(),(0,s.j4)(N,{key:0,padding:""},{default:l((()=>[o,r,(0,s.Wm)($,{modelValue:x.search,"onUpdate:modelValue":t[1]||(t[1]=e=>x.search=e),debounce:"500",filled:"",placeholder:"Search",hint:"Type in the driver's name",class:"q-mb-lg"},{append:l((()=>[(0,s.Wm)(C,{name:"search"})])),_:1},8,["modelValue"]),x.drivers.length?((0,s.wg)(),(0,s.j4)(S,{key:0,bordered:"",class:"rounded-borders"},{default:l((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(x.drivers,(t=>((0,s.wg)(),(0,s.j4)(j,{key:t.id,"expand-separator":"",icon:"airline_seat_recline_normal",label:t.name,onBeforeShow:e=>_.loadDriverPhoto(t)},{default:l((()=>[(0,s.Wm)(Z,null,{default:l((()=>[(0,s.Wm)(U,null,{default:l((()=>[(0,s.Wm)("div",d,[(0,s.Wm)("div",n,[u,(0,s.Wm)(V,{square:"",class:"text-grey-8"},{default:l((()=>[(0,s.Uk)("Driver ID: "+(0,i.zw)(t.id),1)])),_:2},1024),t.permanent_vehicle?((0,s.wg)(),(0,s.j4)(V,{key:0,square:"",class:"text-grey-8"},{default:l((()=>[(0,s.Uk)("Permanent Vehicle: "+(0,i.zw)(t.permanent_vehicle.name),1)])),_:2},1024)):(0,s.kq)("",!0),(0,s.Wm)(V,{square:"",class:"text-grey-8"},{default:l((()=>[(0,s.Uk)("Checked in: "+(0,i.zw)(t.available?"Yes":"No"),1)])),_:2},1024),(0,s.Wm)(V,{square:"",class:"text-grey-8"},{default:l((()=>[(0,s.Uk)("Status: "+(0,i.zw)(_.driverStatus(t)),1)])),_:2},1024),e.$store.getters["auth/isSuperUser"]||e.$store.state.auth.user.level>=3?((0,s.wg)(),(0,s.j4)(s.HY,{key:1},[h,(0,s.Wm)("div",c,[(0,s.Wm)(Q,{color:"blue-9",label:"Edit name",icon:"edit",onClick:e=>{x.editing={id:t.id,name:t.name},x.showEditDialog=!0}},null,8,["onClick"]),(0,s.Wm)(Q,{color:"blue-9",label:"Upload Photo (<2MB)",icon:"file_upload",onClick:e=>_.uploadPhoto(t),loading:x.uploading,disable:x.uploading},null,8,["onClick","loading","disable"]),(0,s.Wm)(Q,{color:"red-7",label:"Delete driver",icon:"delete",onClick:e=>{x.deleting=t,x.showDeleteDialog=!0}},null,8,["onClick"])]),m,t.photo?((0,s.wg)(),(0,s.j4)("img",{key:0,class:"rounded-borders",src:t.photo,alt:"Driver's photo",width:"256",height:"256"},null,8,["src"])):((0,s.wg)(),(0,s.j4)("div",p," There isn't a photo for this driver. Upload one using the button above. "))],64)):(0,s.kq)("",!0)]),(0,s.Wm)("div",g,[v,(0,s.Wm)(L,{value:t.id},null,8,["value"]),f])])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","onBeforeShow"])))),128))])),_:1})):((0,s.wg)(),(0,s.j4)("div",w," No driver found. ")),(0,s.Wm)(E,{accept:".jpg, .png","max-file-size":"2097152",onRejected:k.onRejected,ref:"uploader",style:{visibility:"hidden",height:"0"},onAdded:_.added},null,8,["onRejected","onAdded"]),(0,s.Wm)(P,{modelValue:x.showDeleteDialog,"onUpdate:modelValue":t[2]||(t[2]=e=>x.showDeleteDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:l((()=>[(0,s.Wm)(Z,{style:{width:"350px"}},{default:l((()=>[(0,s.Wm)(U,null,{default:l((()=>[y])),_:1}),(0,s.Wm)(U,{class:"row items-center"},{default:l((()=>[(0,s.Wm)("span",D,"This driver will be permanently deleted: "+(0,i.zw)(x.deleting.name)+"(ID: "+(0,i.zw)(x.deleting.id)+")",1)])),_:1}),(0,s.Wm)(I,{align:"right",class:"bg-white"},{default:l((()=>[(0,s.wy)((0,s.Wm)(Q,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[F]]),(0,s.wy)((0,s.Wm)(Q,{label:"Confirm",class:"text-white",color:"red-7",onClick:_.deleteDriver},null,8,["onClick"]),[[F]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.Wm)(P,{modelValue:x.showEditDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>x.showEditDialog=e),persistent:""},{default:l((()=>[(0,s.Wm)(Z,{style:{"min-width":"350px","max-width":"450px"}},{default:l((()=>[(0,s.Wm)(U,null,{default:l((()=>[b])),_:1}),(0,s.Wm)(U,{class:"q-pt-none q-gutter-y-sm"},{default:l((()=>[(0,s.Wm)($,{filled:"",modelValue:x.editing.name,"onUpdate:modelValue":t[3]||(t[3]=e=>x.editing.name=e),label:"Name","stack-label":""},null,8,["modelValue"])])),_:1}),(0,s.Wm)(I,{align:"right",class:"text-primary"},{default:l((()=>[(0,s.wy)((0,s.Wm)(Q,{flat:"",label:"Cancel"},null,512),[[F]]),(0,s.wy)((0,s.Wm)(Q,{flat:"",label:"Submit",onClick:_.updateDriver},null,8,["onClick"]),[[F]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.Wm)(P,{modelValue:x.showCreateDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>x.showCreateDialog=e),persistent:""},{default:l((()=>[(0,s.Wm)(Z,{style:{"min-width":"350px","max-width":"450px"}},{default:l((()=>[(0,s.Wm)(U,null,{default:l((()=>[W])),_:1}),(0,s.Wm)(U,{class:"q-pt-none q-gutter-y-sm"},{default:l((()=>[(0,s.Wm)($,{filled:"",modelValue:x.newDriverName,"onUpdate:modelValue":t[5]||(t[5]=e=>x.newDriverName=e),label:"Name","stack-label":""},null,8,["modelValue"])])),_:1}),(0,s.Wm)(I,{align:"right",class:"text-primary"},{default:l((()=>[(0,s.wy)((0,s.Wm)(Q,{flat:"",label:"Cancel"},null,512),[[F]]),(0,s.wy)((0,s.Wm)(Q,{flat:"",label:"Create",onClick:_.createDriver},null,8,["onClick"]),[[F]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),e.$store.getters["auth/isSuperUser"]||e.$store.state.auth.user.level>=3?((0,s.wg)(),(0,s.j4)(A,{key:2,position:"bottom-right",offset:[50,50]},{default:l((()=>[(0,s.Wm)(Q,{fab:"",icon:"add",color:"blue-9",onClick:t[7]||(t[7]=e=>x.showCreateDialog=!0)})])),_:1})):(0,s.kq)("",!0)])),_:1})):((0,s.wg)(),(0,s.j4)(N,{key:1,class:"flex flex-center"},{default:l((()=>[(0,s.Wm)("div",q,[(0,s.Wm)(z,{color:"blue-9",size:"50px"})])])),_:1}))}));var x=a(5117),_=a(8825);const C={name:"Drivers",data(){return{isLoaded:!1,search:"",drivers:[],showEditDialog:!1,showDeleteDialog:!1,editing:null,deleting:null,showCreateDialog:!1,newDriverName:"",uploading:!1,uploadingDriverID:null}},setup(){const e=(0,_.Z)();function t(e){return e.filter((e=>e.size<2097152))}function a(t){e.notify({type:"negative",message:"The file(s) you were trying to upload did not pass validation constraints"})}return{checkFileSize:t,onRejected:a}},components:{VueQrcode:x.Z},methods:{driverStatus(e){return e.available?e.vehicle?"DISPATCHED: driving vehicle id: "+e.vehicle.name:e.warehouse?"AVAILABLE: at warehouse: "+e.warehouse.name:"ERROR: checked in but not in a warehouse":"UNAVAILABLE: not checked in"},loadDriversList(e=""){""===e?this.$api.get("/driver/index").then((e=>{this.drivers=e.data,this.isLoaded=!0})).catch((e=>{var t;this.$q.notify({message:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})})):this.$api.post("/driver/search",{name:e,company_id:this.$store.state.auth.user.company_id}).then((e=>{this.drivers=e.data,this.isLoaded=!0})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},deleteDriver(){this.$api.post("/driver/"+this.deleting.id+"/destroy").then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadDriversList(this.search)})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},updateDriver(){this.$api.post("/driver/"+this.editing.id+"/update",this.editing).then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadDriversList(this.search)})).catch((e=>{var t;console.log(e),this.$q.notify({message:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},check(e){this.$api.post("/driver/"+e.id+"/check").then((e=>{this.$q.notify({message:"Successfully checked user ",color:"green-9"}),this.loadDriversList(this.search)})).catch((e=>{var t;console.log(e),this.$q.notify({message:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},createDriver(){this.$api.post("/driver/store",{name:this.newDriverName}).then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadDriversList(this.search)})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})})),this.newDriverName=""},uploadPhoto(e){this.uploadingDriverID=e.id,this.$refs.uploader.reset(),this.$refs.uploader.pickFiles()},added(e){this.uploading=!0;var t=new FormData;t.append("file",e[0]),this.$api.post("/upload/driver/"+this.uploadingDriverID,t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{this.uploading=!1,this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.drivers.forEach(((e,t)=>{e.id===this.uploadingDriverID&&this.loadDriverPhoto(e)}))})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},loadDriverPhoto(e){this.$api.get("/driver/"+e.id+"/photo").then((t=>{this.drivers.forEach(((t,a)=>{t.id===e.id&&(this.drivers[a].photo=this.$api.defaults.baseURL+"/driver/"+e.id+"/photo?t="+Date.now())}))}))}},watch:{search(e){this.loadDriversList(e)}},mounted(){this.loadDriversList()}};var $=a(4379),V=a(4842),Q=a(4554),L=a(7011),U=a(4615),Z=a(151),j=a(5589),S=a(7030),E=a(2165),I=a(5252),P=a(6778),A=a(9367),N=a(1007),z=a(9754),F=a(677),R=a(7518),B=a.n(R);C.render=k,C.__scopeId="data-v-d2389db2";const T=C;B()(C,"components",{QPage:$.Z,QInput:V.Z,QIcon:Q.Z,QList:L.Z,QExpansionItem:U.Z,QCard:Z.Z,QCardSection:j.Z,QChip:S.Z,QBtn:E.Z,QUploader:I.Z,QDialog:P.Z,QCardActions:A.Z,QPageSticky:N.Z,QSpinner:z.Z}),B()(C,"directives",{ClosePopup:F.Z})}}]);
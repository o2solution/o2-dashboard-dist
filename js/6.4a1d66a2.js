(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[6],{1475:function(){(function(e,o,a){"use strict";L.AwesomeMarkers={},L.AwesomeMarkers.version="2.0.1",L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",prefix:"glyphicon",spinClass:"fa-spin",extraClasses:"",icon:"home",markerColor:"blue",iconColor:"white"},initialize:function(e){e=L.Util.setOptions(this,e)},createIcon:function(){var e=o.createElement("div"),a=this.options;return a.icon&&(e.innerHTML=this._createInner()),a.bgPos&&(e.style.backgroundPosition=-a.bgPos.x+"px "+-a.bgPos.y+"px"),this._setIconStyles(e,"icon-"+a.markerColor),e},_createInner:function(){var e,o="",a="",t="",s=this.options;return e=s.icon.slice(0,s.prefix.length+1)===s.prefix+"-"?s.icon:s.prefix+"-"+s.icon,s.spin&&"string"===typeof s.spinClass&&(o=s.spinClass),s.iconColor&&("white"===s.iconColor||"black"===s.iconColor?a="icon-"+s.iconColor:t="style='color: "+s.iconColor+"' "),"<i "+t+"class='"+s.extraClasses+" "+s.prefix+" "+e+" "+o+" "+a+"'></i>"},_setIconStyles:function(e,o){var a,t=this.options,s=L.point(t["shadow"===o?"shadowSize":"iconSize"]);a="shadow"===o?L.point(t.shadowAnchor||t.iconAnchor):L.point(t.iconAnchor),!a&&s&&(a=s.divideBy(2,!0)),e.className="awesome-marker-"+o+" "+t.className,a&&(e.style.marginLeft=-a.x+"px",e.style.marginTop=-a.y+"px"),s&&(e.style.width=s.x+"px",e.style.height=s.y+"px")},createShadow:function(){var e=o.createElement("div");return this._setIconStyles(e,"shadow"),e}}),L.AwesomeMarkers.icon=function(e){return new L.AwesomeMarkers.Icon(e)}})(0,document)},6:(e,o,a)=>{"use strict";a.r(o),a.d(o,{default:()=>D});var t=a(3673);const s=(0,t.HX)("data-v-895a75de");(0,t.dD)("data-v-895a75de");const n=(0,t.Wm)("div",{class:"text-h4"},"Settings",-1),l=(0,t.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"Manage settings for your company.",-1),i=(0,t.Uk)(" For the dashboard to work, you must first set up your API here. "),r={class:"row"},d={class:"col-xs-12 col-sm-6 col-md-4 q-gutter-y-md"},p=(0,t.Wm)("div",{class:"col-xs-12 col-sm-6 col-md-8"},null,-1),c=(0,t.Uk)(" This will be the map's starting position and zoom distance for all users in your company. Click on the map to choose a new position. "),u=(0,t.Uk)(" Current Starting Position "),m=(0,t.Uk)(" Upload your company's logo here, and it will show in your login page."),h=(0,t.Wm)("br",null,null,-1),g=(0,t.Uk)(" We only accept .jpg and .png images with the size of no larger than 2,048 KB. "),y=(0,t.Wm)("div",{class:"q-my-md"}," Company Logo ",-1),f={key:1},w=(0,t.Wm)("div",{class:"text-h6"},"Are you sure?",-1),b=(0,t.Wm)("span",{class:"q-mb-md"},"Your company's map starting position will be changed. This will affect all users in your company.",-1),C={class:"col-auto"};(0,t.Cn)();const k=s(((e,o,a,k,_,x)=>{const L=(0,t.up)("q-card-section"),v=(0,t.up)("q-input"),W=(0,t.up)("q-card"),A=(0,t.up)("q-expansion-item"),z=(0,t.up)("q-list"),P=(0,t.up)("l-tile-layer"),S=(0,t.up)("l-tooltip"),U=(0,t.up)("l-marker"),q=(0,t.up)("l-map"),$=(0,t.up)("q-btn"),I=(0,t.up)("q-uploader"),Z=(0,t.up)("q-card-actions"),T=(0,t.up)("q-dialog"),V=(0,t.up)("q-page"),M=(0,t.up)("q-spinner"),Q=(0,t.Q2)("close-popup");return x.hasPermission&&_.isLoaded?((0,t.wg)(),(0,t.j4)(V,{key:0,padding:""},{default:s((()=>[n,l,e.$store.state.auth.user.allow_set_api?((0,t.wg)(),(0,t.j4)(z,{key:0,bordered:"",class:"rounded-borders"},{default:s((()=>[(0,t.Wm)(A,{"expand-separator":"",icon:"mdi-api",label:"API","default-opened":""},{default:s((()=>[(0,t.Wm)(W,null,{default:s((()=>[(0,t.Wm)(L,null,{default:s((()=>[i])),_:1}),(0,t.Wm)(L,null,{default:s((()=>[(0,t.Wm)("div",r,[(0,t.Wm)("div",d,[(0,t.Wm)(v,{filled:"",modelValue:_.company.api_address,"onUpdate:modelValue":[o[1]||(o[1]=e=>_.company.api_address=e),x.submitChanges],hint:"Your company's API Address. Must be accessible by the dashboard.",placeholder:"https://api.example.com/",label:"API HTTP Address","stack-label":"",style:{"max-width":"600px"},debounce:"500"},null,8,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(v,{filled:"",modelValue:_.company.auth_user,"onUpdate:modelValue":[o[2]||(o[2]=e=>_.company.auth_user=e),x.submitChanges],hint:"User for the HTTP Basic Auth of your API.",label:"Basic Auth User","stack-label":"",style:{"max-width":"600px"},debounce:"500"},null,8,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(v,{filled:"",modelValue:_.company.auth_password,"onUpdate:modelValue":[o[3]||(o[3]=e=>_.company.auth_password=e),x.submitChanges],hint:"Password for the HTTP Basic Auth of your API.",label:"Basic Auth Password","stack-label":"",style:{"max-width":"600px"},debounce:"500",type:"password"},null,8,["modelValue","onUpdate:modelValue"])]),p])])),_:1})])),_:1})])),_:1})])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(z,{bordered:"",class:"rounded-borders q-mt-md"},{default:s((()=>[(0,t.Wm)(A,{"expand-separator":"",icon:"mdi-map-legend",label:"Live Map Starting Position","default-opened":""},{default:s((()=>[(0,t.Wm)(W,null,{default:s((()=>[(0,t.Wm)(L,null,{default:s((()=>[c])),_:1}),(0,t.Wm)(L,null,{default:s((()=>[(0,t.Wm)(q,{zoomAnimation:!0,"marker-zoom-animation":!0,center:_.companyLatlng,zoom:_.zoom,options:_.mapOptions,style:{height:"50vh"},"onUpdate:zoom":x.zoomUpdate,onClick:x.onMapClick,class:"rounded-borders"},{default:s((()=>[(0,t.Wm)(P,{url:_.url},null,8,["url"]),(0,t.Wm)(U,{"lat-lng":_.companyLatlng,icon:x.markerIcon},{default:s((()=>[(0,t.Wm)(S,null,{default:s((()=>[u])),_:1})])),_:1},8,["lat-lng","icon"])])),_:1},8,["center","zoom","options","onUpdate:zoom","onClick"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,t.Wm)(z,{bordered:"",class:"rounded-borders q-mt-md"},{default:s((()=>[(0,t.Wm)(A,{"expand-separator":"",icon:"image",label:"Company Logo","default-opened":""},{default:s((()=>[(0,t.Wm)(W,null,{default:s((()=>[(0,t.Wm)(L,null,{default:s((()=>[m,h,g])),_:1}),(0,t.Wm)(L,null,{default:s((()=>[(0,t.Wm)($,{onClick:x.selectFile,color:"blue-9",label:"Upload company logo",loading:_.uploading,disable:_.uploading,icon:"file_upload"},null,8,["onClick","loading","disable"]),(0,t.Wm)(I,{accept:".jpg, .png","max-file-size":"2097152",onRejected:k.onRejected,ref:"uploader",style:{visibility:"hidden",height:"0"},onAdded:x.added},null,8,["onRejected","onAdded"]),y,_.companyLogo?((0,t.wg)(),(0,t.j4)("img",{key:0,src:_.companyLogo,ref:"cLogo",alt:"Company Logo",width:"128",height:"128"},null,8,["src"])):((0,t.wg)(),(0,t.j4)("div",f," Your company have never submitted a logo. "))])),_:1})])),_:1})])),_:1})])),_:1}),(0,t.Wm)(T,{modelValue:_.showChangeSPDialog,"onUpdate:modelValue":o[4]||(o[4]=e=>_.showChangeSPDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:s((()=>[(0,t.Wm)(W,{style:{width:"350px"}},{default:s((()=>[(0,t.Wm)(L,null,{default:s((()=>[w])),_:1}),(0,t.Wm)(L,{class:"row items-center"},{default:s((()=>[b])),_:1}),(0,t.Wm)(Z,{align:"right",class:"bg-white"},{default:s((()=>[(0,t.wy)((0,t.Wm)($,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[Q]]),(0,t.wy)((0,t.Wm)($,{flat:"",label:"Confirm",class:"text-blue-9",onClick:x.changeStartingPosition},null,8,["onClick"]),[[Q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):((0,t.wg)(),(0,t.j4)(V,{key:1,class:"flex flex-center"},{default:s((()=>[(0,t.Wm)("div",C,[(0,t.Wm)(M,{color:"blue-9",size:"50px"})])])),_:1}))}));var _=a(8825),x=a(385),v=a(8892);a(1475);const W={name:"Settings",components:{LMap:v.iA,LTileLayer:v.Hw,LMarker:v.$R,LTooltip:v.Gs},setup(){const e=(0,_.Z)();function o(e){return e.filter((e=>e.size<2097152))}function a(o){e.notify({type:"negative",message:"The file(s) you were trying to upload did not pass validation constraints"})}return{checkFileSize:o,onRejected:a}},data(){return{isLoaded:!1,company:null,zoom:6,url:"https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}&s={s}",mapOptions:{attributionControl:!1,zoomSnap:.5},currentZoom:6,newLatlng:null,showChangeSPDialog:!1,companyLatlng:(0,x.latLng)(0,0),uploading:!1,companyLogo:null}},computed:{hasPermission(){return!!this.$store.getters["auth/isSuperUser"]||this.$store.state.auth.user.level>=3},markerIcon(){return L.AwesomeMarkers.icon({prefix:"mdi",icon:"flag",markerColor:"blue",iconColor:"white"})}},watch:{hasPermission(e){e||this.unauthorizedRedirect()}},mounted(){this.hasPermission?(this.$api.get("/company/"+this.$store.getters["auth/user"].company.slug+"/logo").then((e=>{this.companyLogo=this.$api.defaults.baseURL+"/company/"+this.$store.getters["auth/user"].company.slug+"/logo?t="+Date.now()})),this.loadCompanySettings()):this.unauthorizedRedirect()},methods:{loadCompanySettings(){this.$api.get("/company/"+this.$store.getters["auth/user"].company.slug).then((e=>{this.company=e.data,this.companyLatlng=(0,x.latLng)(this.company.latitude,this.company.longitude),this.zoom=this.company.zoom,this.isLoaded=!0}))},zoomUpdate(e){this.currentZoom=e},onMapClick(e){e.latlng&&(this.newLatlng=e.latlng,this.showChangeSPDialog=!0)},changeStartingPosition(){this.$api.post("/company/"+this.company.id+"/update/sp",{latitude:this.newLatlng.lat,longitude:this.newLatlng.lng,zoom:this.currentZoom}).then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadCompanySettings()})).catch((e=>{var o;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(o=e.response.data.message)&&void 0!==o?o:"Failed to execute this operation.",color:"red-9"})}))},selectFile(){this.$refs.uploader.reset(),this.$refs.uploader.pickFiles()},added(e){this.uploading=!0;var o=new FormData;o.append("file",e[0]),this.$api.post("/upload",o,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{this.uploading=!1,this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.companyLogo=null,this.$nextTick((()=>{this.companyLogo=this.$api.defaults.baseURL+"/company/"+this.$store.getters["auth/user"].company.slug+"/logo?t="+Date.now()}))})).catch((e=>{var o;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(o=e.response.data.message)&&void 0!==o?o:"Failed to execute this operation.",color:"red-9"})}))},submitChanges(){this.$api.post("/company/"+this.company.id+"/update/settings",{api_address:this.company.api_address,auth_user:this.company.auth_user,auth_password:this.company.auth_password}).then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.loadCompanySettings()})).catch((e=>{var o;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(o=e.response.data.message)&&void 0!==o?o:"Failed to execute this operation.",color:"red-9"})}))}}};var A=a(4379),z=a(7011),P=a(4615),S=a(151),U=a(5589),q=a(4842),$=a(2165),I=a(5252),Z=a(6778),T=a(9367),V=a(9754),M=a(677),Q=a(7518),j=a.n(Q);W.render=k,W.__scopeId="data-v-895a75de";const D=W;j()(W,"components",{QPage:A.Z,QList:z.Z,QExpansionItem:P.Z,QCard:S.Z,QCardSection:U.Z,QInput:q.Z,QBtn:$.Z,QUploader:I.Z,QDialog:Z.Z,QCardActions:T.Z,QSpinner:V.Z}),j()(W,"directives",{ClosePopup:M.Z})}}]);
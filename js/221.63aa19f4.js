(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[221],{1475:function(){(function(e,s,t){"use strict";L.AwesomeMarkers={},L.AwesomeMarkers.version="2.0.1",L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",prefix:"glyphicon",spinClass:"fa-spin",extraClasses:"",icon:"home",markerColor:"blue",iconColor:"white"},initialize:function(e){e=L.Util.setOptions(this,e)},createIcon:function(){var e=s.createElement("div"),t=this.options;return t.icon&&(e.innerHTML=this._createInner()),t.bgPos&&(e.style.backgroundPosition=-t.bgPos.x+"px "+-t.bgPos.y+"px"),this._setIconStyles(e,"icon-"+t.markerColor),e},_createInner:function(){var e,s="",t="",a="",o=this.options;return e=o.icon.slice(0,o.prefix.length+1)===o.prefix+"-"?o.icon:o.prefix+"-"+o.icon,o.spin&&"string"===typeof o.spinClass&&(s=o.spinClass),o.iconColor&&("white"===o.iconColor||"black"===o.iconColor?t="icon-"+o.iconColor:a="style='color: "+o.iconColor+"' "),"<i "+a+"class='"+o.extraClasses+" "+o.prefix+" "+e+" "+s+" "+t+"'></i>"},_setIconStyles:function(e,s){var t,a=this.options,o=L.point(a["shadow"===s?"shadowSize":"iconSize"]);t="shadow"===s?L.point(a.shadowAnchor||a.iconAnchor):L.point(a.iconAnchor),!t&&o&&(t=o.divideBy(2,!0)),e.className="awesome-marker-"+s+" "+a.className,t&&(e.style.marginLeft=-t.x+"px",e.style.marginTop=-t.y+"px"),o&&(e.style.width=o.x+"px",e.style.height=o.y+"px")},createShadow:function(){var e=s.createElement("div");return this._setIconStyles(e,"shadow"),e}}),L.AwesomeMarkers.icon=function(e){return new L.AwesomeMarkers.Icon(e)}})(0,document)},6221:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ce});var a=t(3673),o=t(2323),l=t(8880);const i=(0,a.HX)("data-v-48892760");(0,a.dD)("data-v-48892760");const n=(0,a.Wm)("div",{class:"text-h4"},"Logs",-1),r=(0,a.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"All travels finished with a valid gatepass.",-1),d={class:"row text-grey-8"},c={class:"col-xs-12 col-sm-12 col-md-4"},m={class:"rounded-borders q-pa-sm bg-grey-3 flex flex-inline q-mb-sm q-mr-sm"},u=(0,a.Wm)("div",{class:"text-subtitle1 text-grey-6"},"Vehicle",-1),h={class:"text-body1"},g={class:"rounded-borders q-pa-sm bg-grey-3 flex flex-inline q-mr-sm"},p=(0,a.Wm)("div",{class:"text-subtitle1 text-grey-6"},"Driver",-1),f={class:"text-body1"},x={class:"col-xs-12 col-sm-12 col-md-4"},w={class:"rounded-borders q-pa-sm bg-grey-3 flex flex-inline q-mb-sm q-mr-sm"},v=(0,a.Wm)("div",{class:"text-subtitle1 text-grey-6"},"Starting Warehouse",-1),W={class:"text-body1"},y={class:"rounded-borders q-pa-sm bg-grey-3 flex flex-inline q-mr-sm"},b=(0,a.Wm)("div",{class:"text-subtitle1 text-grey-6"},"Destined Warehouse",-1),_={class:"text-body1"},k={class:"col-xs-12 col-sm-12 col-md-4"},z={class:"rounded-borders q-pa-sm bg-grey-3 flex flex-inline q-mb-sm"},q=(0,a.Wm)("div",{class:"text-subtitle1 text-grey-6"},"Started At",-1),C={class:"text-body1"},R={class:"rounded-borders q-pa-sm bg-grey-3 flex flex-inline"},A=(0,a.Wm)("div",{class:"text-subtitle1 text-grey-6"},"Ended At",-1),D={class:"text-body1"},I={class:"col-auto"},P={class:"text-grey-9"},F=(0,a.Wm)("div",{class:"text-grey-5"},"Starting Warehouse",-1),M={class:"col-auto"},S={class:"text-grey-9"},$=(0,a.Wm)("div",{class:"text-grey-5"},"Destined Warehouse",-1),T={class:"row"},N={key:1,class:"col-auto"},Q={class:"row q-mt-md justify-center"},V=(0,a.Wm)("div",{class:"text-h6"},"Are you sure?",-1),Z=(0,a.Wm)("span",{class:"q-mb-md"},"This log will be permanently deleted for all users in your company.",-1),j=(0,a.Wm)("div",{class:"col-auto"},[(0,a.Wm)("div",{class:"text-blue-9 text-h5"},"Please wait"),(0,a.Wm)("div",{class:"text-blue-9 text-subtitle1"},"Fetching logs & building maps, this may take a while...")],-1);(0,a.Cn)();const E=i(((e,s,t,L,E,U)=>{const O=(0,a.up)("q-space"),B=(0,a.up)("q-icon"),H=(0,a.up)("q-card-section"),G=(0,a.up)("l-tile-layer"),Y=(0,a.up)("l-tooltip"),K=(0,a.up)("l-marker"),X=(0,a.up)("l-polyline"),J=(0,a.up)("l-feature-group"),ee=(0,a.up)("l-map"),se=(0,a.up)("q-btn"),te=(0,a.up)("q-card"),ae=(0,a.up)("q-expansion-item"),oe=(0,a.up)("q-list"),le=(0,a.up)("q-pagination"),ie=(0,a.up)("q-card-actions"),ne=(0,a.up)("q-dialog"),re=(0,a.up)("q-page"),de=(0,a.Q2)("close-popup");return U.hasPermission&&E.isLoaded?((0,a.wg)(),(0,a.j4)(re,{key:0,padding:""},{default:i((()=>[n,r,E.logs.length?(0,a.wy)(((0,a.wg)(),(0,a.j4)(oe,{key:0,bordered:"",class:"rounded-borders"},{default:i((()=>[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(E.logs,(e=>((0,a.wg)(),(0,a.j4)(ae,{key:e.id,"expand-separator":"",icon:"feed",label:U.getLogLabel(e),modelValue:E.logsTabs[e.id],"onUpdate:modelValue":s=>E.logsTabs[e.id]=s,"default-opened":""},{default:i((()=>[(0,a.Wm)(te,null,{default:i((()=>[(0,a.Wm)(H,null,{default:i((()=>[(0,a.Wm)("div",d,[(0,a.Wm)("div",c,[(0,a.Wm)("div",m,[(0,a.Wm)("div",null,[u,(0,a.Wm)("div",h,(0,o.zw)(e.vehicle?e.vehicle.name:"Not Found")+"(ID: "+(0,o.zw)(e.vehicle?e.vehicle.id:"null")+")",1)]),(0,a.Wm)(O),(0,a.Wm)(B,{name:"mdi-"+(e.vehicle?e.vehicle.icon:"truck"),size:"xl"},null,8,["name"])]),(0,a.Wm)("div",g,[(0,a.Wm)("div",null,[p,(0,a.Wm)("div",f,(0,o.zw)(e.driver?e.driver.name:"Not Found")+"(ID: "+(0,o.zw)(e.driver?e.driver.id:"null")+")",1)]),(0,a.Wm)(O),(0,a.Wm)(B,{name:"airline_seat_recline_normal",size:"xl"})])]),(0,a.Wm)("div",x,[(0,a.Wm)("div",w,[(0,a.Wm)("div",null,[v,(0,a.Wm)("div",W,(0,o.zw)(e.starting_warehouse?e.starting_warehouse.name:"Not Found"),1)]),(0,a.Wm)(O),(0,a.Wm)(B,{name:"mdi-warehouse",size:"xl"})]),(0,a.Wm)("div",y,[(0,a.Wm)("div",null,[b,(0,a.Wm)("div",_,(0,o.zw)(e.warehouse?e.warehouse.name:"Not Found"),1)]),(0,a.Wm)(O),(0,a.Wm)(B,{name:"mdi-warehouse",size:"xl"})])]),(0,a.Wm)("div",k,[(0,a.Wm)("div",z,[(0,a.Wm)("div",null,[q,(0,a.Wm)("div",C,(0,o.zw)(e.started_at),1)]),(0,a.Wm)(O),(0,a.Wm)(B,{name:"today",size:"xl"})]),(0,a.Wm)("div",R,[(0,a.Wm)("div",null,[A,(0,a.Wm)("div",D,(0,o.zw)(e.ended_at),1)]),(0,a.Wm)(O),(0,a.Wm)(B,{name:"event_available",size:"xl"})])])])])),_:2},1024),(0,a.Wm)(H,{class:"flex"},{default:i((()=>[(0,a.Wm)(ee,{zoomAnimation:!0,"marker-zoom-animation":!0,zoom:13,options:{attributionControl:!1,zoomSnap:.5},class:"rounded-borders",style:{"min-height":"200px"},ref:U.setMapRef,"max-zoom":22,"min-zoom":1},{default:i((()=>[(0,a.Wm)(G,{url:"https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}&s={s}"}),(0,a.Wm)(J,{ref:U.setFeaturesRef},{default:i((()=>[(0,a.Wm)(K,{"lat-lng":U.getLatLng(e.starting_warehouse),icon:U.getMarkerIcon(e.starting_warehouse)},{default:i((()=>[(0,a.Wm)(Y,{style:{"font-size":"14px"}},{default:i((()=>[(0,a.Wm)("div",I,[(0,a.Wm)("div",P,(0,o.zw)(e.starting_warehouse?e.starting_warehouse.name:"Not Found"),1),F])])),_:2},1024)])),_:2},1032,["lat-lng","icon"]),(0,a.Wm)(K,{"lat-lng":U.getLatLng(e.warehouse),icon:U.getMarkerIcon(e.warehouse)},{default:i((()=>[(0,a.Wm)(Y,{style:{"font-size":"14px"}},{default:i((()=>[(0,a.Wm)("div",M,[(0,a.Wm)("div",S,(0,o.zw)(e.warehouse?e.warehouse.name:"NotFound"),1),$])])),_:2},1024)])),_:2},1032,["lat-lng","icon"]),(0,a.Wm)(X,{"lat-lngs":[U.getLatLng(e.starting_warehouse),U.getLatLng(e.warehouse)]},null,8,["lat-lngs"])])),_:2},1536)])),_:2},1032,["options"])])),_:2},1024),(0,a.Wm)(H,null,{default:i((()=>[(0,a.Wm)("div",T,[(0,a.Wm)(O),(0,a.Wm)(se,{icon:"delete",color:"red-7",onClick:s=>{E.deleting=e,E.showDeleteDialog=!0},label:"Delete this log"},null,8,["onClick"])])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","modelValue","onUpdate:modelValue"])))),128))])),_:1},512)),[[l.F8,E.isActuallyLoaded]]):((0,a.wg)(),(0,a.j4)("div",N," No log found. ")),(0,a.Wm)("div",Q,[(0,a.Wm)(le,{modelValue:E.page,"onUpdate:modelValue":s[1]||(s[1]=e=>E.page=e),max:E.maxPage,"direction-links":"","boundary-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])]),(0,a.Wm)(ne,{modelValue:E.showDeleteDialog,"onUpdate:modelValue":s[2]||(s[2]=e=>E.showDeleteDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:i((()=>[(0,a.Wm)(te,{style:{width:"350px"}},{default:i((()=>[(0,a.Wm)(H,null,{default:i((()=>[V])),_:1}),(0,a.Wm)(H,{class:"row items-center"},{default:i((()=>[Z])),_:1}),(0,a.Wm)(ie,{align:"right",class:"bg-white"},{default:i((()=>[(0,a.wy)((0,a.Wm)(se,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[de]]),(0,a.wy)((0,a.Wm)(se,{label:"Confirm",class:"text-white",color:"red-7",onClick:U.deleteLog},null,8,["onClick"]),[[de]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):((0,a.wg)(),(0,a.j4)(re,{key:1,class:"flex flex-center"},{default:i((()=>[j])),_:1}))}));t(7280);var U=t(8828),O=t.n(U),B=(t(4065),t(385)),H=t(8892);t(1475);const G={name:"Logs",data(){return{isLoaded:!1,maxPage:1,logs:[],featuresRefs:[],mapRefs:[],logsTabs:[],isActuallyLoaded:!1,deleting:null,showDeleteDialog:!1,page:1}},components:{LMap:H.iA,LTileLayer:H.Hw,LMarker:H.$R,LTooltip:H.Gs,LFeatureGroup:H.m7,LPolyline:H.P6},computed:{hasPermission(){return!!this.$store.getters["auth/isSuperUser"]||this.$store.state.auth.user.level>=3}},watch:{hasPermission(e){e||this.unauthorizedRedirect()},page(e){this.logs=[],this.featuresRefs=[],this.mapRefs=[],this.logsTabs=[],this.isLoaded=!1,this.isActuallyLoaded=!1,this.loadLogs()}},methods:{deleteLog(){this.$api.post("/log/"+this.deleting.id+"/destroy").then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-9"}),this.$router.go()})).catch((e=>{var s;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))},setFeaturesRef(e){e&&(!this.featuresRefs.length||this.featuresRefs.length<this.logs.length)&&this.featuresRefs.push(e)},setMapRef(e){e&&(!this.mapRefs.length||this.mapRefs.length<this.logs.length)&&this.mapRefs.push(e)},showRoute(){this.$nextTick((()=>{if(this.featuresRefs.length<1)return this.showRoute();this.featuresRefs.forEach(((e,s)=>"function"!==typeof e.leafletObject.getLayers||e.leafletObject.getLayers().length<3?this.showRoute():void this.mapRefs[s].leafletObject.fitBounds(e.leafletObject.getBounds())))}))},getMarkerIcon(e){return L.AwesomeMarkers.icon({prefix:"mdi",icon:e?e.icon||"warehouse":"",markerColor:e&&e.color||"blue",iconColor:"white"})},getLatLng(e){return e?(0,B.latLng)(e.latitude||0,e.longitude||0):(0,B.latLng)(0,0)},unauthorizedRedirect(){this.$router.push("/"),this.$q.notify({message:"You are not authorized to use this page.",color:"red-7"})},loadLogs(){this.isLoaded=!1,this.$api.get("/log/count").then((e=>{this.maxPage=Math.ceil(e.data/10),0===this.maxPage?(this.maxPage=1,this.logs=[],this.isLoaded=!0):this.$api.get("/log/"+this.page).then((e=>{this.logs=e.data,this.isLoaded=!0,this.showRoute(),this.$nextTick((()=>{this.logs.forEach((e=>{this.logsTabs[e.id]=!1})),this.isActuallyLoaded=!0}))})).catch((e=>{var s;this.$q.notify({message:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))})).catch((e=>{var s;this.$q.notify({message:null!==(s=e.response.data.message)&&void 0!==s?s:"Failed to execute this operation.",color:"red-9"})}))},getLogLabel(e){let s=new Date(e.started_at.split(" ")[0]).getTime()/1e3,t=new Date(e.ended_at.split(" ")[0]).getTime()/1e3;return console.log(s),console.log(t),O()(1e3*(t-s))+": Vehicle: "+(e.vehicle?e.vehicle.name+"(ID: "+e.vehicle.id+"): ":"Not Found: ")+(e.starting_warehouse?e.starting_warehouse.name:"Not Found")+" -> "+(e.warehouse?e.warehouse.name:"Not Found")}},mounted(){this.loadLogs()}};var Y=t(4379),K=t(7011),X=t(4615),J=t(151),ee=t(5589),se=t(2025),te=t(4554),ae=t(2165),oe=t(7300),le=t(6778),ie=t(9367),ne=t(677),re=t(7518),de=t.n(re);G.render=E,G.__scopeId="data-v-48892760";const ce=G;de()(G,"components",{QPage:Y.Z,QList:K.Z,QExpansionItem:X.Z,QCard:J.Z,QCardSection:ee.Z,QSpace:se.Z,QIcon:te.Z,QBtn:ae.Z,QPagination:oe.Z,QDialog:le.Z,QCardActions:ie.Z}),de()(G,"directives",{ClosePopup:ne.Z})}}]);
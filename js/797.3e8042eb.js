"use strict";(self["webpackChunko2_dashboard"]=self["webpackChunko2_dashboard"]||[]).push([[797],{9797:(e,t,s)=>{s.r(t),s.d(t,{default:()=>te});var a=s(3673),l=s(2323),o=s(8880);const n=(0,a.Wm)("div",{class:"text-h4"},"Site Settings",-1),r=(0,a.Wm)("div",{class:"text-subtitle1 q-mb-lg"},"Manage settings for this website.",-1),i=(0,a.Uk)(" For the dashboard to work, other than correctly setting up API credentials in each company's settings, please make sure to set up task scheduling, so that the dashboard can keep fetching data from the API in the background. This web app is built using laravel framework as another layer of API, and for this reason, task scheduling is pretty easy to set up. See: "),d=(0,a.Wm)("a",{href:"https://laravel.com/docs/8.x/scheduling#running-the-scheduler"},"https://laravel.com/docs/8.x/scheduling#running-the-scheduler",-1),u=(0,a.Wm)("br",null,null,-1),p=(0,a.Uk)(" For performance concerns, I hard coded that the dashboard fetches data from API and updates all vehicles' status for all companies every 5 seconds(If task scheduling/cron is set up correctly). So, accordingly, when you view the live map or vehicles' location, the web app also send request to the backend to update the page every 5 seconds."),c=(0,a.Wm)("br",null,null,-1),h=(0,a.Uk)(" Contact me if you'd like to change how often it updates.(For example, if you want to make it less often for better performance.) "),m=(0,a.Uk)(" Warning: the dashboard never performed any requests to the tracking API yet.. Did you set up task scheduling?"),g=(0,a.Wm)("br",null,null,-1),w=(0,a.Uk)(" As long as this message appears, the dashboard will NOT be working properly. "),f=(0,a.Uk)(" Warning: it's been a while since the the last time we were in contact with the tracking API."),_=(0,a.Wm)("br",null,null,-1),b=(0,a.Uk)(" Connection with the tracking API seems OK."),U=(0,a.Wm)("br",null,null,-1),k=(0,a.Uk)(" Choose if you'd like to allow companies to access certain settings. These settings will be available in the company's settings pages, and if not allowed, they will only be shown to super users. "),S={class:"flex flex-center"},y={class:"col-auto"},W=(0,a.Uk)(" Super users have complete control over the dashboard, including add/remove super users, changing the site's settings and view/edit all companies' data."),q=(0,a.Wm)("br",null,null,-1),v=(0,a.Uk)(" Super users will not be listed in the companies' user list. To edit a super user's profile, first demote them to a reguar user. "),x=(0,a.Uk)(" Please enter the user you want to make super user "),I=(0,a.Wm)("div",{class:"text-h6"},"Are you sure?",-1),C={class:"q-mb-md"},A=(0,a.Wm)("div",{class:"text-h6"},"Are you sure?",-1),D=(0,a.Wm)("span",{class:"q-mb-md"},"The following super users will be demoted to regular users to the last company they switched to:",-1),$={class:"col-auto"};function P(e,t,s,P,Q,Z){const z=(0,a.up)("q-card-section"),j=(0,a.up)("q-card"),V=(0,a.up)("q-expansion-item"),L=(0,a.up)("q-list"),R=(0,a.up)("q-checkbox"),F=(0,a.up)("q-spinner"),T=(0,a.up)("q-btn"),E=(0,a.up)("q-item-section"),O=(0,a.up)("q-item"),N=(0,a.up)("q-item-label"),B=(0,a.up)("q-select"),K=(0,a.up)("q-table"),Y=(0,a.up)("q-skeleton"),H=(0,a.up)("q-card-actions"),M=(0,a.up)("q-dialog"),G=(0,a.up)("q-page"),J=(0,a.Q2)("ripple"),X=(0,a.Q2)("close-popup");return Z.isSuperUser?((0,a.wg)(),(0,a.j4)(G,{key:0,padding:""},{default:(0,a.w5)((()=>[n,r,(0,a.Wm)(L,{bordered:"",class:"rounded-borders"},{default:(0,a.w5)((()=>[(0,a.Wm)(V,{"expand-separator":"",icon:"warning",label:"Important Notices","default-opened":""},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[i,d,u,p,c,h])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.Wm)(L,{bordered:"",class:"rounded-borders q-mt-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(V,{"expand-separator":"",icon:"api",label:"API Connection Status","default-opened":""},{default:(0,a.w5)((()=>[Q.temp_key?((0,a.wg)(),(0,a.j4)(j,{key:0},{default:(0,a.w5)((()=>["never"===Q.temp_key?((0,a.wg)(),(0,a.j4)(z,{key:0,class:"bg-yellow-7"},{default:(0,a.w5)((()=>[m,g,w])),_:1})):Q.minutes_without_updating>60?((0,a.wg)(),(0,a.j4)(z,{key:1,class:"bg-yellow-7"},{default:(0,a.w5)((()=>[f,_,(0,a.Uk)(" Last request to the tracking API from the dashboard API backend was made at "+(0,l.zw)(Q.last_api_request)+" ("+(0,l.zw)(parseInt(Q.minutes_without_updating/60)>60?parseInt(parseInt(Q.minutes_without_updating/60)/60)+" hour(s)":parseInt(Q.minutes_without_updating/60)+" minute(s)")+" ago) ",1)])),_:1})):((0,a.wg)(),(0,a.j4)(z,{key:2,class:"bg-green-6 text-grey-2"},{default:(0,a.w5)((()=>[b,U,(0,a.Uk)(" Last request to the tracking API from the dashboard API backend was made at "+(0,l.zw)(Q.last_api_request),1)])),_:1}))])),_:1})):(0,a.kq)("",!0)])),_:1})])),_:1}),(0,a.Wm)(L,{bordered:"",class:"rounded-borders q-mt-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(V,{"expand-separator":"",icon:"segment",label:"Company Actions","default-opened":"",onBeforeShow:Z.fetchSuperUsers},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[k])),_:1}),null!==Q.allow_set_api?((0,a.wg)(),(0,a.j4)(z,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(R,{modelValue:Q.allow_set_api,"onUpdate:modelValue":[t[1]||(t[1]=e=>Q.allow_set_api=e),Z.updateSiteSettings],label:"Allow companies to access API settings"},null,8,["modelValue","onUpdate:modelValue"]),(0,a.Wm)(R,{modelValue:Q.allow_set_logo,"onUpdate:modelValue":[t[2]||(t[2]=e=>Q.allow_set_logo=e),Z.updateSiteSettings],label:"Allow companies to set their logos"},null,8,["modelValue","onUpdate:modelValue"])])),_:1})):((0,a.wg)(),(0,a.j4)(z,{key:1},{default:(0,a.w5)((()=>[(0,a.Wm)("div",S,[(0,a.Wm)("div",y,[(0,a.Wm)(F,{color:"blue-9",size:"50px"})])])])),_:1}))])),_:1})])),_:1},8,["onBeforeShow"])])),_:1}),(0,a.Wm)(L,{bordered:"",class:"rounded-borders q-mt-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(V,{"expand-separator":"",icon:"admin_panel_settings",label:"Super Users","default-opened":"",onBeforeShow:Z.fetchSuperUsers},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[W,q,v])),_:1}),(0,a.Wm)(o.uT,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,a.w5)((()=>[Q.superUserRows.length?((0,a.wg)(),(0,a.j4)(K,{key:0,selection:"multiple",selected:Q.selectedSuperUsers,"onUpdate:selected":t[5]||(t[5]=e=>Q.selectedSuperUsers=e),title:"Registered super users",rows:Q.superUserRows,columns:Q.superUserColumns,"row-key":"id",dark:"",class:"bg-blue-9"},{"top-right":(0,a.w5)((()=>[(0,a.Wm)(T,{color:"white","text-color":"blue-9",icon:"person_add",label:"Add","no-caps":"",onClick:t[3]||(t[3]=t=>e.$refs.addSUSelect.showPopup())}),(0,a.Wm)(T,{color:"red-7","text-color":"white",icon:"person_remove",label:"Demote","no-caps":"",onClick:t[4]||(t[4]=e=>Q.showDeleteSUDialog=!0),class:"q-ml-sm",disabled:!Q.selectedSuperUsers.length},null,8,["disabled"]),(0,a.Wm)(B,{ref:"addSUSelect",filled:"","model-value":"",onInputValue:Z.listenSUSelectInputChange,"use-input":"","input-debounce":"500",label:"Name/Username",style:{width:"250px"},behavior:"dialog",class:"hidden"},{"no-option":(0,a.w5)((()=>[Q.addSUSelectOptions.length?((0,a.wg)(),(0,a.j4)(L,{key:1,bordered:"",separator:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(Q.addSUSelectOptions,(e=>(0,a.wy)(((0,a.wg)(),(0,a.j4)(O,{clickable:"",key:e.id,onClick:t=>{Q.promotingUser=e,Q.showAddSUDialog=!0}},{default:(0,a.w5)((()=>[(0,a.Wm)(E,null,{default:(0,a.w5)((()=>[(0,a.Wm)(N,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.username),1)])),_:2},1024),(0,a.Wm)(N,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)("Name: "+(0,l.zw)(e.name)+", ID: "+(0,l.zw)(e.id),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[J]]))),128))])),_:1})):((0,a.wg)(),(0,a.j4)(O,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(E,{class:"text-grey"},{default:(0,a.w5)((()=>[x])),_:1})])),_:1}))])),_:1},8,["onInputValue"])])),_:1},8,["selected","rows","columns"])):(0,a.kq)("",!0)])),_:1}),Q.superUserRows.length?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(Y,{key:0,animation:"blink",height:"150px",class:"bg-blue-3"}))])),_:1})])),_:1},8,["onBeforeShow"])])),_:1}),(0,a.Wm)(M,{modelValue:Q.showAddSUDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>Q.showAddSUDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{style:{width:"350px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[I])),_:1}),(0,a.Wm)(z,{class:"row items-center"},{default:(0,a.w5)((()=>[(0,a.Wm)("span",C,"This user will be promoted to a super user: "+(0,l.zw)(Q.promotingUser.username)+" (Name: "+(0,l.zw)(Q.promotingUser.name)+", ID: "+(0,l.zw)(Q.promotingUser.id)+")",1)])),_:1}),(0,a.Wm)(H,{align:"right",class:"bg-white"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(T,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[X]]),(0,a.wy)((0,a.Wm)(T,{label:"Confirm",class:"text-blue-9",onClick:Z.makeSuperUser},null,8,["onClick"]),[[X]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(M,{modelValue:Q.showDeleteSUDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>Q.showDeleteSUDialog=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{style:{width:"350px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[A])),_:1}),(0,a.Wm)(z,{class:"row items-center"},{default:(0,a.w5)((()=>[D,(0,a.Wm)("ul",null,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(Q.selectedSuperUsers,(e=>((0,a.wg)(),(0,a.j4)("li",{key:e.id},(0,l.zw)(e.username)+" (ID: "+(0,l.zw)(e.id)+")",1)))),128))])])),_:1}),(0,a.Wm)(H,{align:"right",class:"bg-white"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(T,{flat:"",label:"Cancel",class:"text-blue-9"},null,512),[[X]]),(0,a.wy)((0,a.Wm)(T,{label:"Confirm",class:"text-white",color:"red-7",onClick:Z.deleteSuperUsers},null,8,["onClick"]),[[X]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):((0,a.wg)(),(0,a.j4)(G,{key:1,class:"flex flex-center"},{default:(0,a.w5)((()=>[(0,a.Wm)("div",$,[(0,a.Wm)(F,{color:"blue-9",size:"50px"})])])),_:1}))}const Q={name:"SiteSettings",methods:{unauthorizedRedirect(){this.$router.push("/"),this.$q.notify({message:"You are not authorized to use this page.",color:"red-7"})},fetchSuperUsers(){this.$api.get("/user/super/index").then((e=>{this.superUserRows=e.data})).catch((e=>{this.$q.notify({message:"Failed to fetch list of super users.",color:"red-9"})}))},deleteSuperUsers(){this.requestedEntryLength=this.selectedSuperUsers.length,this.$api.post("/user/super/update",this.superUserDeletionList).then((e=>{this.fetchSuperUsers(),this.$q.notify({message:"Deleted "+this.requestedEntryLength+" entr"+(this.requestedEntryLength>1?"ies":"y")+".",color:"green-7"})})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})})),this.selectedSuperUsers=[]},listenSUSelectInputChange(e){this.isSUSelectLoading=!0,this.$api.post("/user/search",{nou:e}).then((e=>{this.isSUSelectLoading=!1,this.addSUSelectOptions=e.data})).catch((e=>{var t;this.addSUSelectOptions=[],this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},makeSuperUser(){this.$api.post("/user/super/promote",this.promotingUser).then((e=>{this.fetchSuperUsers(),this.$q.notify({message:e.data.messages[0]})})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))},updateSiteSettings(){this.$api.post("/site-settings",{allow_set_api:this.allow_set_api,allow_set_logo:this.allow_set_logo}).then((e=>{this.$q.notify({message:e.data.messages[0],color:"green-7"})})).catch((e=>{var t;this.$q.notify({message:void 0!==e.response.data.messages&&e.response.data.messages.length?e.response.data.messages[0]:null!==(t=e.response.data.message)&&void 0!==t?t:"Failed to execute this operation.",color:"red-9"})}))}},data(){return{superUserColumns:[{name:"id",label:"User ID",align:"center",field:"id"},{name:"username",align:"center",label:"Username",field:"username"},{name:"name",align:"center",label:"Name",field:"name"},{name:"email",align:"center",label:"Email",field:"email"}],superUserRows:[],selectedSuperUsers:[],requestedEntryLength:0,showDeleteSUDialog:!1,showAddSUDialog:!1,addSUSelectOptions:[],isSUSelectLoading:!1,promotingUser:null,allow_set_api:null,allow_set_logo:null,temp_key:null,last_api_request:null,minutes_without_updating:0}},computed:{superUserDeletionList(){var e=[];return this.selectedSuperUsers.forEach((t=>e.push({id:t.id}))),e},isSuperUser(){return this.$store.getters["auth/isSuperUser"]}},mounted(){this.isSuperUser?(this.fetchSuperUsers(),this.$api.get("/site-settings").then((e=>{this.allow_set_api=e.data["allow_company_set_api"],this.allow_set_logo=e.data["allow_company_set_logo"],this.temp_key=e.data["temp_key"],this.last_api_request=e.data["last_api_request"],this.minutes_without_updating=e.data["minutes_without_updating"]})).catch((e=>{this.$q.notify({message:"Failed to fetch site settings.",color:"red-9"})}))):this.unauthorizedRedirect()},watch:{isSuperUser(e){e||this.unauthorizedRedirect()}}};var Z=s(4379),z=s(7011),j=s(4615),V=s(151),L=s(5589),R=s(1420),F=s(9754),T=s(6429),E=s(2165),O=s(3314),N=s(3414),B=s(2035),K=s(2350),Y=s(4103),H=s(6778),M=s(9367),G=s(6489),J=s(677),X=s(7518),ee=s.n(X);Q.render=P;const te=Q;ee()(Q,"components",{QPage:Z.Z,QList:z.Z,QExpansionItem:j.Z,QCard:V.Z,QCardSection:L.Z,QCheckbox:R.Z,QSpinner:F.Z,QTable:T.Z,QBtn:E.Z,QSelect:O.Z,QItem:N.Z,QItemSection:B.Z,QItemLabel:K.Z,QSkeleton:Y.ZP,QDialog:H.Z,QCardActions:M.Z}),ee()(Q,"directives",{Ripple:G.Z,ClosePopup:J.Z})}}]);